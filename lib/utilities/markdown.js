"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    default: function() {
        return _default;
    },
    postprocess: function() {
        return postprocess;
    }
});
var _necessary = require("necessary");
var clear = _necessary.arrayUtilities.clear, first = _necessary.arrayUtilities.first, push = _necessary.arrayUtilities.push;
function postprocess(divisionMarkdownNode, context) {
    var divisionMarkdownNodes = [
        divisionMarkdownNode
    ];
    resolveIncludes(divisionMarkdownNodes, context);
    resolveEmbeddings(divisionMarkdownNodes, context);
    paginateAndFootnotes(divisionMarkdownNodes, context);
    createContents(divisionMarkdownNodes, context);
    return divisionMarkdownNodes;
}
function createContents(divisionMarkdownNodes, context) {
    divisionMarkdownNodes.some(function(divisionMarkdownNode) {
        var contentsCreated = divisionMarkdownNode.createContents(context);
        if (contentsCreated) {
            return true;
        }
    });
}
function resolveIncludes(divisionMarkdownNodes, context) {
    var firstDivisionMarkdownNode = first(divisionMarkdownNodes), divisionMarkdownNode = firstDivisionMarkdownNode; ///
    Object.assign(context, {
        divisionMarkdownNodes: divisionMarkdownNodes
    });
    divisionMarkdownNode.resolveIncludes(context);
    delete context.divisionMarkdownNodes;
    return divisionMarkdownNodes;
}
function resolveEmbeddings(divisionMarkdownNodes, context) {
    divisionMarkdownNodes.forEach(function(divisionMarkdownNode) {
        divisionMarkdownNode.resolveEmbeddings(context);
    });
}
function paginateAndFootnotes(divisionMarkdownNodes, context) {
    var _context_linesPerPage = context.linesPerPage, linesPerPage = _context_linesPerPage === void 0 ? null : _context_linesPerPage;
    var footnoteNumberMap = {};
    Object.assign(context, {
        footnoteNumberMap: footnoteNumberMap
    });
    var pageNumber = 1;
    if (linesPerPage === null) {
        divisionMarkdownNodes.forEach(function(divisionMarkdownNode) {
            var footnoteReplacements = divisionMarkdownNode.prepareFootnotes(context);
            divisionMarkdownNode.setPageNumber(pageNumber);
            divisionMarkdownNode.createFootnotes(footnoteReplacements, context);
            pageNumber++;
        });
    } else {
        var paginatedDivisionMarkdownNodes = [];
        divisionMarkdownNodes.forEach(function(divisionMarkdownNode) {
            var footnoteReplacements = divisionMarkdownNode.prepareFootnotes(context), _$divisionMarkdownNodes = divisionMarkdownNode.paginate(context);
            _$divisionMarkdownNodes.forEach(function(divisionMarkdownNode) {
                divisionMarkdownNode.setPageNumber(pageNumber);
                divisionMarkdownNode.createFootnotes(footnoteReplacements, context);
                pageNumber++;
            });
            push(paginatedDivisionMarkdownNodes, _$divisionMarkdownNodes);
        });
        clear(divisionMarkdownNodes);
        push(divisionMarkdownNodes, paginatedDivisionMarkdownNodes);
    }
    delete context.footnoteNumberMap;
}
var _default = {
    postprocess: postprocess
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvbWFya2Rvd24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5jb25zdCB7IGNsZWFyLCBmaXJzdCwgcHVzaCB9ID0gYXJyYXlVdGlsaXRpZXM7XG5cbmV4cG9ydCBmdW5jdGlvbiBwb3N0cHJvY2VzcyhkaXZpc2lvbk1hcmtkb3duTm9kZSwgY29udGV4dCkge1xuICBjb25zdCBkaXZpc2lvbk1hcmtkb3duTm9kZXMgPSBbXG4gICAgZGl2aXNpb25NYXJrZG93bk5vZGVcbiAgXTtcblxuICByZXNvbHZlSW5jbHVkZXMoZGl2aXNpb25NYXJrZG93bk5vZGVzLCBjb250ZXh0KTtcblxuICByZXNvbHZlRW1iZWRkaW5ncyhkaXZpc2lvbk1hcmtkb3duTm9kZXMsIGNvbnRleHQpO1xuXG4gIHBhZ2luYXRlQW5kRm9vdG5vdGVzKGRpdmlzaW9uTWFya2Rvd25Ob2RlcywgY29udGV4dCk7XG5cbiAgY3JlYXRlQ29udGVudHMoZGl2aXNpb25NYXJrZG93bk5vZGVzLCBjb250ZXh0KTtcblxuICByZXR1cm4gZGl2aXNpb25NYXJrZG93bk5vZGVzO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDb250ZW50cyhkaXZpc2lvbk1hcmtkb3duTm9kZXMsIGNvbnRleHQpIHtcbiAgZGl2aXNpb25NYXJrZG93bk5vZGVzLnNvbWUoKGRpdmlzaW9uTWFya2Rvd25Ob2RlKSA9PiB7XG4gICAgY29uc3QgY29udGVudHNDcmVhdGVkID0gZGl2aXNpb25NYXJrZG93bk5vZGUuY3JlYXRlQ29udGVudHMoY29udGV4dCk7XG5cbiAgICBpZiAoY29udGVudHNDcmVhdGVkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZXNvbHZlSW5jbHVkZXMoZGl2aXNpb25NYXJrZG93bk5vZGVzLCBjb250ZXh0KSB7XG4gIGNvbnN0IGZpcnN0RGl2aXNpb25NYXJrZG93bk5vZGUgPSBmaXJzdChkaXZpc2lvbk1hcmtkb3duTm9kZXMpLFxuICAgICAgICBkaXZpc2lvbk1hcmtkb3duTm9kZSA9IGZpcnN0RGl2aXNpb25NYXJrZG93bk5vZGU7IC8vL1xuXG4gIE9iamVjdC5hc3NpZ24oY29udGV4dCwge1xuICAgIGRpdmlzaW9uTWFya2Rvd25Ob2Rlc1xuICB9KTtcblxuICBkaXZpc2lvbk1hcmtkb3duTm9kZS5yZXNvbHZlSW5jbHVkZXMoY29udGV4dCk7XG5cbiAgZGVsZXRlIGNvbnRleHQuZGl2aXNpb25NYXJrZG93bk5vZGVzO1xuXG4gIHJldHVybiBkaXZpc2lvbk1hcmtkb3duTm9kZXM7XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVFbWJlZGRpbmdzKGRpdmlzaW9uTWFya2Rvd25Ob2RlcywgY29udGV4dCkge1xuICBkaXZpc2lvbk1hcmtkb3duTm9kZXMuZm9yRWFjaCgoZGl2aXNpb25NYXJrZG93bk5vZGUpID0+IHtcbiAgICBkaXZpc2lvbk1hcmtkb3duTm9kZS5yZXNvbHZlRW1iZWRkaW5ncyhjb250ZXh0KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHBhZ2luYXRlQW5kRm9vdG5vdGVzKGRpdmlzaW9uTWFya2Rvd25Ob2RlcywgY29udGV4dCkge1xuICBjb25zdCB7IGxpbmVzUGVyUGFnZSA9IG51bGwgfSA9IGNvbnRleHQ7XG5cbiAgY29uc3QgZm9vdG5vdGVOdW1iZXJNYXAgPSB7fTtcblxuICBPYmplY3QuYXNzaWduKGNvbnRleHQsIHtcbiAgICBmb290bm90ZU51bWJlck1hcFxuICB9KTtcblxuICBsZXQgcGFnZU51bWJlciA9IDE7XG5cbiAgaWYgKGxpbmVzUGVyUGFnZSA9PT0gbnVsbCkge1xuICAgIGRpdmlzaW9uTWFya2Rvd25Ob2Rlcy5mb3JFYWNoKChkaXZpc2lvbk1hcmtkb3duTm9kZSkgPT4ge1xuICAgICAgY29uc3QgZm9vdG5vdGVSZXBsYWNlbWVudHMgPSBkaXZpc2lvbk1hcmtkb3duTm9kZS5wcmVwYXJlRm9vdG5vdGVzKGNvbnRleHQpO1xuXG4gICAgICBkaXZpc2lvbk1hcmtkb3duTm9kZS5zZXRQYWdlTnVtYmVyKHBhZ2VOdW1iZXIpO1xuXG4gICAgICBkaXZpc2lvbk1hcmtkb3duTm9kZS5jcmVhdGVGb290bm90ZXMoZm9vdG5vdGVSZXBsYWNlbWVudHMsIGNvbnRleHQpO1xuXG4gICAgICBwYWdlTnVtYmVyKys7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgcGFnaW5hdGVkRGl2aXNpb25NYXJrZG93bk5vZGVzID0gW107XG5cbiAgICBkaXZpc2lvbk1hcmtkb3duTm9kZXMuZm9yRWFjaCgoZGl2aXNpb25NYXJrZG93bk5vZGUpID0+IHtcbiAgICAgIGNvbnN0IGZvb3Rub3RlUmVwbGFjZW1lbnRzID0gZGl2aXNpb25NYXJrZG93bk5vZGUucHJlcGFyZUZvb3Rub3Rlcyhjb250ZXh0KSxcbiAgICAgICAgICAgIGRpdmlzaW9uTWFya2Rvd25Ob2RlcyA9IGRpdmlzaW9uTWFya2Rvd25Ob2RlLnBhZ2luYXRlKGNvbnRleHQpO1xuXG4gICAgICBkaXZpc2lvbk1hcmtkb3duTm9kZXMuZm9yRWFjaCgoZGl2aXNpb25NYXJrZG93bk5vZGUpID0+IHtcbiAgICAgICAgZGl2aXNpb25NYXJrZG93bk5vZGUuc2V0UGFnZU51bWJlcihwYWdlTnVtYmVyKTtcblxuICAgICAgICBkaXZpc2lvbk1hcmtkb3duTm9kZS5jcmVhdGVGb290bm90ZXMoZm9vdG5vdGVSZXBsYWNlbWVudHMsIGNvbnRleHQpO1xuXG4gICAgICAgIHBhZ2VOdW1iZXIrKztcbiAgICAgIH0pO1xuXG4gICAgICBwdXNoKHBhZ2luYXRlZERpdmlzaW9uTWFya2Rvd25Ob2RlcywgZGl2aXNpb25NYXJrZG93bk5vZGVzKTtcbiAgICB9KTtcblxuICAgIGNsZWFyKGRpdmlzaW9uTWFya2Rvd25Ob2Rlcyk7XG5cbiAgICBwdXNoKGRpdmlzaW9uTWFya2Rvd25Ob2RlcywgcGFnaW5hdGVkRGl2aXNpb25NYXJrZG93bk5vZGVzKTtcbiAgfVxuXG4gIGRlbGV0ZSBjb250ZXh0LmZvb3Rub3RlTnVtYmVyTWFwO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIHBvc3Rwcm9jZXNzXG59O1xuIl0sIm5hbWVzIjpbInBvc3Rwcm9jZXNzIiwiY2xlYXIiLCJhcnJheVV0aWxpdGllcyIsImZpcnN0IiwicHVzaCIsImRpdmlzaW9uTWFya2Rvd25Ob2RlIiwiY29udGV4dCIsImRpdmlzaW9uTWFya2Rvd25Ob2RlcyIsInJlc29sdmVJbmNsdWRlcyIsInJlc29sdmVFbWJlZGRpbmdzIiwicGFnaW5hdGVBbmRGb290bm90ZXMiLCJjcmVhdGVDb250ZW50cyIsInNvbWUiLCJjb250ZW50c0NyZWF0ZWQiLCJmaXJzdERpdmlzaW9uTWFya2Rvd25Ob2RlIiwiT2JqZWN0IiwiYXNzaWduIiwiZm9yRWFjaCIsImxpbmVzUGVyUGFnZSIsImZvb3Rub3RlTnVtYmVyTWFwIiwicGFnZU51bWJlciIsImZvb3Rub3RlUmVwbGFjZW1lbnRzIiwicHJlcGFyZUZvb3Rub3RlcyIsInNldFBhZ2VOdW1iZXIiLCJjcmVhdGVGb290bm90ZXMiLCJwYWdpbmF0ZWREaXZpc2lvbk1hcmtkb3duTm9kZXMiLCJwYWdpbmF0ZSJdLCJyYW5nZU1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7IiwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztJQW9HQSxPQUVFO2VBRkY7O0lBOUZnQkEsV0FBVztlQUFYQTs7O3lCQUplO0FBRS9CLElBQVFDLFFBQXVCQyx5QkFBYyxDQUFyQ0QsT0FBT0UsUUFBZ0JELHlCQUFjLENBQTlCQyxPQUFPQyxPQUFTRix5QkFBYyxDQUF2QkU7QUFFZixTQUFTSixZQUFZSyxvQkFBb0IsRUFBRUMsT0FBTztJQUN2RCxJQUFNQyx3QkFBd0I7UUFDNUJGO0tBQ0Q7SUFFREcsZ0JBQWdCRCx1QkFBdUJEO0lBRXZDRyxrQkFBa0JGLHVCQUF1QkQ7SUFFekNJLHFCQUFxQkgsdUJBQXVCRDtJQUU1Q0ssZUFBZUosdUJBQXVCRDtJQUV0QyxPQUFPQztBQUNUO0FBRUEsU0FBU0ksZUFBZUoscUJBQXFCLEVBQUVELE9BQU87SUFDcERDLHNCQUFzQkssSUFBSSxDQUFDLFNBQUNQO1FBQzFCLElBQU1RLGtCQUFrQlIscUJBQXFCTSxjQUFjLENBQUNMO1FBRTVELElBQUlPLGlCQUFpQjtZQUNuQixPQUFPO1FBQ1Q7SUFDRjtBQUNGO0FBRUEsU0FBU0wsZ0JBQWdCRCxxQkFBcUIsRUFBRUQsT0FBTztJQUNyRCxJQUFNUSw0QkFBNEJYLE1BQU1JLHdCQUNsQ0YsdUJBQXVCUywyQkFBMkIsR0FBRztJQUUzREMsT0FBT0MsTUFBTSxDQUFDVixTQUFTO1FBQ3JCQyx1QkFBQUE7SUFDRjtJQUVBRixxQkFBcUJHLGVBQWUsQ0FBQ0Y7SUFFckMsT0FBT0EsUUFBUUMscUJBQXFCO0lBRXBDLE9BQU9BO0FBQ1Q7QUFFQSxTQUFTRSxrQkFBa0JGLHFCQUFxQixFQUFFRCxPQUFPO0lBQ3ZEQyxzQkFBc0JVLE9BQU8sQ0FBQyxTQUFDWjtRQUM3QkEscUJBQXFCSSxpQkFBaUIsQ0FBQ0g7SUFDekM7QUFDRjtBQUVBLFNBQVNJLHFCQUFxQkgscUJBQXFCLEVBQUVELE9BQU87SUFDMUQsNEJBQWdDQSxRQUF4QlksY0FBQUEsa0RBQWU7SUFFdkIsSUFBTUMsb0JBQW9CLENBQUM7SUFFM0JKLE9BQU9DLE1BQU0sQ0FBQ1YsU0FBUztRQUNyQmEsbUJBQUFBO0lBQ0Y7SUFFQSxJQUFJQyxhQUFhO0lBRWpCLElBQUlGLGlCQUFpQixNQUFNO1FBQ3pCWCxzQkFBc0JVLE9BQU8sQ0FBQyxTQUFDWjtZQUM3QixJQUFNZ0IsdUJBQXVCaEIscUJBQXFCaUIsZ0JBQWdCLENBQUNoQjtZQUVuRUQscUJBQXFCa0IsYUFBYSxDQUFDSDtZQUVuQ2YscUJBQXFCbUIsZUFBZSxDQUFDSCxzQkFBc0JmO1lBRTNEYztRQUNGO0lBQ0YsT0FBTztRQUNMLElBQU1LLGlDQUFpQyxFQUFFO1FBRXpDbEIsc0JBQXNCVSxPQUFPLENBQUMsU0FBQ1o7WUFDN0IsSUFBTWdCLHVCQUF1QmhCLHFCQUFxQmlCLGdCQUFnQixDQUFDaEIsVUFDN0RDLDBCQUF3QkYscUJBQXFCcUIsUUFBUSxDQUFDcEI7WUFFNURDLHdCQUFzQlUsT0FBTyxDQUFDLFNBQUNaO2dCQUM3QkEscUJBQXFCa0IsYUFBYSxDQUFDSDtnQkFFbkNmLHFCQUFxQm1CLGVBQWUsQ0FBQ0gsc0JBQXNCZjtnQkFFM0RjO1lBQ0Y7WUFFQWhCLEtBQUtxQixnQ0FBZ0NsQjtRQUN2QztRQUVBTixNQUFNTTtRQUVOSCxLQUFLRyx1QkFBdUJrQjtJQUM5QjtJQUVBLE9BQU9uQixRQUFRYSxpQkFBaUI7QUFDbEM7SUFFQSxXQUFlO0lBQ2JuQixhQUFBQTtBQUNGIn0=